<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Auth - Frontend</title>
    <link rel="stylesheet" href="styles.css">
    <script>
      // Script de prueba para depurar conexión
      window.addEventListener('load', async () => {
        try {
          console.log('Probando conexión al backend...');
          const response = await fetch('http://127.0.0.1:5000/registry', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({username: 'testdebug', password: 'Debug123!'})
          });
          const data = await response.json();
          console.log('Respuesta:', {status: response.status, data});
        } catch(e) {
          console.error('Error de conexión:', e);
        }
      });
    </script>
  </head>
  <body>
    <main class="container">
      <header class="hero">
        <h1>Bienvenido</h1>
        <p class="subtitle">Accede a tu cuenta o regístrate para comenzar.</p>
      </header>

      <section class="card card--centered" aria-labelledby="login-title">
        <h2 id="login-title">Iniciar sesión</h2>
        <form id="login-form" class="form">
          <label class="form-label">
            Usuario
            <input id="login-username" class="input" type="text" name="username" required autocomplete="username" />
          </label>
          <label class="form-label">
            Contraseña
            <input id="login-password" class="input" type="password" name="password" required autocomplete="current-password" />
          </label>
          <div class="form-actions">
            <button class="btn btn--primary" type="submit">Ingresar</button>
            <button id="check-token" type="button" class="btn btn--ghost">Ver token</button>
          </div>
        </form>
        <div id="login-result" class="result"></div>

        <div class="register-cta">
          <p>¿No tienes cuenta? <button id="open-register" class="link-btn">Regístrate aquí</button></p>
          <small class="muted">Al registrarte recibirás acceso a la API con token JWT.</small>
        </div>

        <div id="account-card" class="account-card hidden">
          <h3>Mi cuenta</h3>
          <p><strong>ID:</strong> <span id="acct-id">-</span></p>
          <p><strong>Usuario:</strong> <span id="acct-username">-</span></p>
          <div class="form-actions">
            <button id="refresh-account" class="btn btn--ghost">Actualizar</button>
            <button id="logout-button" class="btn btn--secondary">Cerrar sesión</button>
          </div>
          <div id="account-result" class="result"></div>
        </div>
      </section>

      <section id="register-section" class="card card--muted" aria-labelledby="register-title">
        <h2 id="register-title">Crear cuenta</h2>
        <form id="register-form" class="form">
          <label class="form-label">
            Usuario
            <input id="register-username" class="input" type="text" name="username" required autocomplete="username" />
          </label>
          <label class="form-label">
            Contraseña
            <input id="register-password" class="input" type="password" name="password" required autocomplete="new-password" />
          </label>
          <div class="form-actions">
            <button class="btn btn--secondary" type="submit">Registrar</button>
          </div>
        </form>
        <div id="register-result" class="result"></div>
      </section>

    </main>

    <script src="app.js"></script>
  </body>
</html>
